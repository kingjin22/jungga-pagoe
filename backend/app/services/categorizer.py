"""
타이틀 기반 카테고리 자동 추론
- 카테고리명 통일: 브랜드딜/뽐뿌/네이버 전부 동일한 이름 사용
- 새 카테고리는 RULES에 한 줄 추가
"""
import re as _re

# (카테고리 이름, 키워드 리스트) — 위에서부터 우선 매칭
RULES = [
    # ── 전자기기 세부 ───────────────────────────────────────────────
    ("노트북/PC",    ["노트북", "laptop", "맥북", "macbook", "데스크탑", "조립pc", "미니pc",
                      "cpu", "gpu", "그래픽카드", "ssd", "ddr", "ram", "메모리", "파워서플라이"]),
    ("모니터/TV",    ["모니터", "monitor", "qled", "oled tv", "144hz", "165hz"]),
    ("스마트폰",     ["아이폰", "iphone", "갤럭시 s", "galaxy s", "pixel", "스마트폰", "휴대폰"]),
    ("태블릿",       ["아이패드", "ipad", "갤럭시탭", "galaxy tab", "태블릿"]),
    ("이어폰/헤드폰",["이어폰", "earphone", "earbuds", "헤드폰", "headphone",
                      "shokz", "jbl flip", "jbl charge", "airpods", "에어팟",
                      "buds", "노이즈캔슬링", "wh-1000", "wf-1000", "quietcomfort"]),
    ("카메라",       ["카메라", "camera", "렌즈", "미러리스", "dslr", "gopro", "액션캠"]),
    ("네트워크",     ["wifi", "router", "공유기", "라우터", "mesh", "wifi7", "wifi6", "zenWiFi"]),
    ("게임",         ["에픽게임즈", "epic games", "free game", "xbox", "playstation", "ps5",
                      "nintendo", "steam", "닌텐도", "게임기", "게임 무료"]),
    # ── 신발 (패션보다 먼저 매칭) ──────────────────────────────────
    ("신발",         ["런닝화", "트레일화", "스니커즈", "트레킹화", "운동화", "신발", "슈즈",
                      # Nike
                      "에어포스", "에어맥스", "에어조던", "덩크로우", "줌플라이", "줌 플라이",
                      "페가수스", "인빈시블", "보메로", "알파플라이", "줌엑스",
                      # Adidas
                      "울트라부스트", "스탠스미스", "아디제로", "삼바 og", "아디다스 삼바",
                      "보스턴 12", "아디오스 프로",
                      # Asics
                      "젤카야노", "젤님버스", "젤쿠무루스", "슈퍼블라스트", "메타스피드",
                      "겔카야노", "겔님버스", "카야노",
                      # Saucony
                      "써코니", "엔돌핀 스피드", "킨바라", "트라이엄프",
                      # Brooks
                      "브룩스 고스트", "브룩스 글리세린", "하이페리온", "아드레날린",
                      # HOKA
                      "호카 클리프톤", "호카 본다이", "호카 마하", "호카 로켓", "클리프톤", "본다이",
                      # NB
                      "뉴발란스 530", "뉴발란스 993", "뉴발란스 2002", "뉴발란스 1906", "뉴발란스 1080",
                      # On Running
                      "클라우드몬스터", "클라우드서퍼", "온러닝",
                      # 기타
                      "컨버스", "반스 올드스쿨", "스피드크로스"]),
    # ── 패션 ────────────────────────────────────────────────────────
    ("패션",         ["드로즈", "팬티", "브라팬티", "반팔", "긴팔", "자켓", "코트",
                      "청바지", "레깅스", "패딩", "다운 재킷", "다운재킷", "바람막이",
                      "후드", "맨투맨", "플리스", "눕시", "트레이닝복", "트랙슈트",
                      "트레이닝바지", "스웨트", "져지", "조거", "반바지",
                      "가방", "백팩", "아디다스 ", "나이키 ", "노스페이스", "파타고니아",
                      "유니클로", "무신사", "아크테릭스", "언더아머", "뉴발란스 "]),
    # ── 생활가전 ────────────────────────────────────────────────────
    ("생활가전",     ["세탁기", "냉장고", "에어컨", "로봇청소기", "청소기", "전자레인지",
                      "오븐", "공기청정기", "가습기", "건조기", "식기세척기", "밥솥",
                      "압력밥솥", "에어프라이어", "커피머신", "에스프레소", "네스프레소",
                      "드롱기", "에어랩", "슈퍼소닉", "다이슨", "스타일러",
                      "헤어드라이기", "헤어드라이어"]),
    # ── 전자기기 (나머지) ──────────────────────────────────────────
    ("전자기기",     ["스마트워치", "갤럭시워치", "애플워치", "galaxy watch", "apple watch",
                      "갤럭시버즈", "galaxy buds", "갤럭시탭",
                      "tv ", "television", "4k", "oled", "qled",
                      "삼성 ", "애플 ", "소니 ", "lg ", "sony ", "apple ",
                      "무선충전", "보조배터리", "충전기", "충전케이블", "케이블",
                      "usb", "hdmi", "c타입", "8핀", "젠더", "어댑터"]),
    # ── 뷰티 ────────────────────────────────────────────────────────
    ("뷰티",         ["마스크팩", "선크림", "선스크린", "세럼", "에센스", "스킨케어",
                      "파운데이션", "올리브영", "샴푸", "린스", "바디워시", "향수",
                      "에스티로더", "설화수", "sk-ii", "이니스프리", "코스알엑스",
                      "클레징", "클렌징", "토너패드", "패드 리필", "수분패드",
                      "수분크림", "로션", "미스트", "립밤", "비비크림", "쿠션"]),
    # ── 식품 ────────────────────────────────────────────────────────
    ("식품",         ["쌈", "채소", "삼겹", "닭가슴", "소고기", "돼지고기", "생수", "음료",
                      "과자", "라면", "참치", "김치", "견과", "홍삼", "숙취",
                      "함박스테이크", "밀키트", "간편식", "식품", "초코", "티코",
                      "커피믹스", "파인애플", "알부민",
                      "쌀", "햅쌀", "현미", "잡곡", "백미",
                      "백산수", "제주 삼다수", "무라벨", "생수 ",
                      "갈비", "갈비살", "목살", "항정살", "삼겹살", "불고기",
                      "고등어", "연어", "새우", "오징어",
                      "사과", "배", "딸기", "토마토", "포도", "수박",
                      "아이스크림", "빵", "케이크", "도넛"]),
    # ── 건강 ────────────────────────────────────────────────────────
    ("건강",         ["마스크", "kf94", "영양제", "비타민", "오메가3", "유산균",
                      "콜라겐", "프로틴", "단백질", "헬스", "보충제",
                      "수면밴드", "수면안대", "수면스프레이", "덴탈마스크", "비말마스크"]),
    # ── 생활용품 ────────────────────────────────────────────────────
    ("생활용품",     ["화장지", "롤화장지", "미용티슈", "물티슈", "키친타올", "위생패드",
                      "생리대", "면생리대", "팬티라이너", "기저귀", "영유아물티슈",
                      "니트릴장갑", "고무장갑", "비닐장갑", "박스테이프", "테이프",
                      "쓰레기봉투", "비닐봉투", "지퍼백", "알뜰폰", "유심", "통신"]),
    # ── 홈리빙 ──────────────────────────────────────────────────────
    ("홈리빙",       ["주방세제", "세제", "세정", "침구", "이불", "베개", "수건",
                      "정리함", "선반", "의자", "책상", "철판버너", "캠핑",
                      "욕실매트", "매트", "화장실", "곰팡이제거", "배수구", "욕실",
                      "텀블러", "보틀", "물병", "워터보틀",
                      "냄비", "팬", "웍", "프라이팬", "주방", "식기", "컵", "머그",
                      "트렁크", "여행가방", "캐리어", "수납박스", "리빙박스",
                      "방향제", "탈취제", "방향", "탈취"]),
    # ── 스포츠 ──────────────────────────────────────────────────────
    ("스포츠",       ["테니스", "배드민턴", "골프", "수영", "스키", "보드", "자전거",
                      "러닝", "요가", "필라테스", "등산", "트레킹", "아웃도어"]),
    # ── 소프트웨어/구독 ──────────────────────────────────────────────
    ("소프트웨어",   ["구독", "vpn", "antivirus", "클라우드", "microsoft 365"]),
    # ── 도서 ────────────────────────────────────────────────────────
    ("도서",         ["책", "도서", "만화", "소설", "교재", "알라딘", "yes24", "교보"]),
]


def infer_category(title: str) -> str:
    """타이틀에서 카테고리 자동 추론. 매칭 없으면 '기타'"""
    title_lower = title.lower()
    for category, keywords in RULES:
        for kw in keywords:
            # ASCII 전용 짧은 키워드(4자 이하)는 단어 경계 체크
            if kw.isascii() and len(kw.strip()) <= 4:
                if _re.search(r'(?<![a-z0-9])' + _re.escape(kw.strip()) + r'(?![a-z0-9])', title_lower):
                    return category
            else:
                if kw.lower() in title_lower:
                    return category
    return "기타"


# 카테고리 표준화 — DB에 이미 저장된 구 이름 → 신 이름 변환
CATEGORY_ALIASES = {
    "패션/의류": "패션",
    "가전": "생활가전",
    "전자기기": "전자기기",
    "소프트웨어": "게임",
}


def normalize_category(cat: str) -> str:
    return CATEGORY_ALIASES.get(cat, cat)
